<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML Preview</title>
</head>
<body>
    <div id="loading-message" style="display: flex; justify-content: center; align-items: center; height: 100vh; font-family: sans-serif; font-size: 1.2rem;">
        Loading HTML...
    </div>

    <div id="error-message" style="display: none; justify-content: center; align-items: center; height: 100vh; font-family: sans-serif; font-size: 1.2rem; color: #dc2626;">
        <!-- Error message will be displayed here -->
    </div>

    <script type="module">
        // Firebase configuration and initialization as requested
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyCOY1Ca_6HxF0fO7t6s_G1agOabD9pBB1I",
          authDomain: "htmlpreviewer-b24f3.firebaseapp.com",
          projectId: "htmlpreviewer-b24f3",
          storageBucket: "htmlpreviewer-b24f3.firebasestorage.app",
          messagingSenderId: "845274858173",
          appId: "1:845274858173:web:d92ac7694bfad81be72dd4",
          measurementId: "G-CJK17Y30L7"
        };
      
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const loadingMessage = document.getElementById('loading-message');
        const errorMessage = document.getElementById('error-message');

        function showErrorMessage(message) {
            loadingMessage.style.display = 'none';
            errorMessage.textContent = message;
            errorMessage.style.display = 'flex';
        }

        async function loadAndRenderHtml() {
            try {
                // Get the ID from the URL
                const urlParams = new URLSearchParams(window.location.search);
                const htmlId = urlParams.get('id');

                if (!htmlId) {
                    showErrorMessage("No HTML ID found in the URL.");
                    return;
                }
                
                // Get the document from Firestore
                const docRef = doc(db, `html_previews`, htmlId);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const htmlContent = docSnap.data().content;
                    
                    // Directly replace the body content with the fetched HTML
                    document.body.innerHTML = htmlContent;
                } else {
                    showErrorMessage("The requested HTML snippet does not exist.");
                }
            } catch (error) {
                console.error("Error fetching document:", error);
                showErrorMessage("An error occurred while loading the HTML.");
            }
        }

        // Authenticate anonymously and then load the content
        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                await signInAnonymously(auth);
            }
            loadAndRenderHtml();
        });
    </script>
</body>
</html>
