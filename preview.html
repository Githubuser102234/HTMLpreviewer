<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <script type="module">
        // Firebase configuration and initialization
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyCOY1Ca_6HxF0fO7t6s_G1agOabD9pBB1I",
          authDomain: "htmlpreviewer-b24f3.firebaseapp.com",
          projectId: "htmlpreviewer-b24f3",
          storageBucket: "htmlpreviewer-b24f3.firebasestorage.app",
          messagingSenderId: "845274858173",
          appId: "1:845274858173:web:d92ac7694bfad81be72dd4",
          measurementId: "G-CJK17Y30L7"
        };
      
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        async function loadAndRenderHtml() {
            // Authenticate anonymously
            await signInAnonymously(auth);

            // Get the ID from the URL
            const urlParams = new URLSearchParams(window.location.search);
            const htmlId = urlParams.get('id');

            if (!htmlId) {
                document.body.innerHTML = "No HTML ID found in the URL. Please go back to the <a href='https://githubuser102234.github.io/HTMLpreviewer/'>editor</a> to create a new one.";
                return;
            }
            
            // Get the document from Firestore
            const docRef = doc(db, `html_previews`, htmlId);
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                const htmlContent = docSnap.data().content;
                
                // Overwrite the entire document with the fetched HTML
                document.open();
                document.write(htmlContent);
                document.close();
            } else {
                document.body.innerHTML = "The requested HTML snippet does not exist. Please go back to the <a href='https://githubuser102234.github.io/HTMLpreviewer/'>editor</a> to create a new one.";
            }
        }

        loadAndRenderHtml();
    </script>
</body>
</html>